<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8" />
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f7f7f7;
            padding: 20px;
        }

        #result-container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            margin-bottom: 20px;
        }

        .stat {
            font-size: 18px;
            margin: 8px 0;
        }

        button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background-color: #4285f4;
            color: white;
        }

        button:hover {
            background-color: #3367d6;
        }
    </style>
</head>

<body>
    <div id="result-container">
        <h1>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h1>
        <div id="stats">
            <!-- –°—é–¥–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ –ø–æ–º—ñ—Å—Ç–∏–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É -->
        </div>
        <button id="to-quiz-list">üîô –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É —Ç–µ—Å—Ç—ñ–≤</button>
    </div>

    <script>
        (function () {
            // 1) –ü—Ä–æ—á–∏—Ç–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑ localStorage
            const raw = localStorage.getItem("lastResult");
            const statsDiv = document.getElementById("stats");

            if (!raw) {
                // –Ø–∫—â–æ localStorage –Ω–µ –º—ñ—Å—Ç–∏—Ç—å key="lastResult"
                statsDiv.innerHTML = "<p>–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø—Ä–æ–π–¥–µ–Ω–∏–π —Ç–µ—Å—Ç.</p>";
                return;
            }

            // 2) –†–æ–∑–ø–∞—Ä—Å–∏–º–æ –æ–± º—î–∫—Ç
            let result;
            try {
                result = JSON.parse(raw);
            } catch (e) {
                statsDiv.innerHTML = "<p>–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.</p>";
                console.error("Error parsing lastResult:", e);
                return;
            }

            // 3) –í—ñ–¥–æ–±—Ä–∞–∑–∏–º–æ —Ñ—ñ–Ω–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            statsDiv.innerHTML = `
        <p class="stat">üî¢ ID —Ç–µ—Å—Ç—É: <strong>${result.testId}</strong></p>
        <p class="stat">‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö: <strong>${result.correct}</strong> –∑ ${result.total}</p>
        <p class="stat">‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö: <strong>${result.incorrect}</strong></p>
        <p class="stat">üèÜ –ó–∞–≥–∞–ª—å–Ω–∏–π –±–∞–ª: <strong>${result.score}</strong> / ${result.total}</p>
      `;

            // 4) –í–∏–∫–æ–Ω–∞—î–º–æ POST /api/results, —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É –±–∞–∑—ñ
            fetch("http://localhost:8080/api/results", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(result)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ");
                    }
                    console.log("–†–µ–∑—É–ª—å—Ç–∞—Ç —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.");
                    // –ó–∞ –±–∞–∂–∞–Ω–Ω—è–º, –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–æ–∂–Ω–∞ –ø—Ä–∏–±—Ä–∞—Ç–∏ –¥–∞–Ω—ñ, —â–æ–±–∏ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –Ω–µ –¥—É–±–ª—é–≤–∞—Ç–∏:
                    // localStorage.removeItem("lastResult");
                })
                .catch(error => {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É:", error);
                });

            // 5) –ö–Ω–æ–ø–∫–∞ ¬´–ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É —Ç–µ—Å—Ç—ñ–≤¬ª
            document.getElementById("to-quiz-list").addEventListener("click", function () {
                window.location.href = "/pages/quiz.html";
            });
        })();
    </script>
</body>

</html>