<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <title>–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        input,
        textarea,
        select {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
        }

        .question-block {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <button onclick="goHome()">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</button>
    <script>
        function goHome() {
            window.location.href = "/index.html";
        }
    </script>
    <h1>–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —Ç–µ—Å—Ç</h1>
    <input id="testTitle" placeholder="–ù–∞–∑–≤–∞ —Ç–µ—Å—Ç—É" />
    <textarea id="testDescription" placeholder="–û–ø–∏—Å —Ç–µ—Å—Ç—É"></textarea>

    <div id="questions"></div>
    <button onclick="addQuestion()">‚ûï –î–æ–¥–∞—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è</button>
    <button onclick="submitTest()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–µ—Å—Ç</button>

    <script>
        let questionCount = 0;

        function addQuestion() {
            if (questionCount >= 12) {
                alert("–ú–∞–∫—Å–∏–º—É–º 12 –ø–∏—Ç–∞–Ω—å");
                return;
            }
            const container = document.getElementById("questions");
            const qid = `q${questionCount}`;
            const block = document.createElement("div");
            block.className = "question-block";
            block.innerHTML = `
                <input id="${qid}_text" placeholder="–¢–µ–∫—Å—Ç –ø–∏—Ç–∞–Ω–Ω—è ${questionCount + 1}" />
                <input id="${qid}_opt0" placeholder="–í–∞—Ä—ñ–∞–Ω—Ç 1" />
                <input id="${qid}_opt1" placeholder="–í–∞—Ä—ñ–∞–Ω—Ç 2" />
                <input id="${qid}_opt2" placeholder="–í–∞—Ä—ñ–∞–Ω—Ç 3" />
                <input id="${qid}_opt3" placeholder="–í–∞—Ä—ñ–∞–Ω—Ç 4" />
                <label>–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:
                    <select id="${qid}_correct">
                        <option value="0">–í–∞—Ä—ñ–∞–Ω—Ç 1</option>
                        <option value="1">–í–∞—Ä—ñ–∞–Ω—Ç 2</option>
                        <option value="2">–í–∞—Ä—ñ–∞–Ω—Ç 3</option>
                        <option value="3">–í–∞—Ä—ñ–∞–Ω—Ç 4</option>
                    </select>
                </label>
            `;
            container.appendChild(block);
            questionCount++;
        }

        async function submitTest() {
            const title = document.getElementById("testTitle").value;
            const description = document.getElementById("testDescription").value;

            const testRes = await fetch("http://localhost:8080/api/tests", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Basic " + btoa("admin:admin123")
                },
                body: JSON.stringify({ title, description })
            });

            const test = await testRes.json();
            const testId = test.id;

            for (let i = 0; i < questionCount; i++) {
                const text = document.getElementById(`q${i}_text`).value;
                const options = [
                    document.getElementById(`q${i}_opt0`).value,
                    document.getElementById(`q${i}_opt1`).value,
                    document.getElementById(`q${i}_opt2`).value,
                    document.getElementById(`q${i}_opt3`).value
                ];
                const correctAnswer = options[document.getElementById(`q${i}_correct`).value];

                await fetch("http://localhost:8080/api/questions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Basic " + btoa("admin:admin123")
                    },
                    body: JSON.stringify({ testId, text, options, correctAnswer })
                });
            }

            alert("‚úÖ –¢–µ—Å—Ç —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ");
            location.href = "admin.html";
        }

        addQuestion();
    </script>
</body>

</html>